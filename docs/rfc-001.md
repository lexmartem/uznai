# RFC-001: Project Setup & Infrastructure

## Summary
This RFC covers the initial setup of the Uznai quiz platform, establishing the foundation for all subsequent development. It includes project configuration, CI/CD pipeline setup, database initialization, and basic infrastructure components that will be required by all future RFCs.

## Features Addressed
- F26: Cost-Effective Hosting
- F28: CI/CD Pipeline

## Technical Approach

### Backend Setup
1. Initialize Spring Boot project with the required dependencies:
   - Spring Web MVC
   - Spring Security
   - Spring Data JPA
   - Lombok
   - MapStruct
   - PostgreSQL driver
   - Flyway for database migrations
   - SLF4J & Logback for logging

2. Configure core infrastructure components:
   - PostgreSQL database connection
   - Spring Security basic configuration (to be expanded in RFC-002)
   - Logging configuration
   - Exception handling framework
   - Basic health check endpoints
   - Virtual thread configuration for improved scalability

3. Create the initial database schema with Flyway migrations:
   - Users table
   - Roles table
   - Quizzes table
   - Questions table
   - Answers table

### Frontend Setup
1. Initialize Next.js project with the required dependencies:
   - TypeScript
   - Tailwind CSS
   - ESLint and Prettier
   - shadcn/ui component library
   - Axios for API requests
   - TanStack Query for data fetching

2. Configure core frontend infrastructure:
   - Tailwind CSS configuration
   - ESLint and Prettier setup
   - Base layout components
   - Type definitions
   - API client setup
   - Environment variable configuration

### CI/CD Pipeline
1. Set up GitHub Actions for continuous integration:
   - Lint code
   - Run tests
   - Build application
   - Deploy to development environment

2. Configure deployment to cost-effective hosting:
   - Railway.app, Render, or Fly.io setup
   - Database provisioning
   - Environment variable configuration
   - Health check monitoring
   - Java 21 runtime configuration

## Database Schema

### Users Table
```
users (
  id UUID PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL UNIQUE,
  password_hash VARCHAR(255) NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
  role_id UUID REFERENCES roles(id)
)
```

### Roles Table
```
roles (
  id UUID PRIMARY KEY,
  name VARCHAR(20) NOT NULL UNIQUE
)
```

### Quizzes Table
```
quizzes (
  id UUID PRIMARY KEY,
  title VARCHAR(100) NOT NULL,
  description TEXT,
  is_public BOOLEAN NOT NULL DEFAULT FALSE,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW(),
  creator_id UUID REFERENCES users(id)
)
```

### Questions Table
```
questions (
  id UUID PRIMARY KEY,
  quiz_id UUID REFERENCES quizzes(id),
  question_text TEXT NOT NULL,
  question_type VARCHAR(20) NOT NULL,
  order_index INTEGER NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW()
)
```

### Answers Table
```
answers (
  id UUID PRIMARY KEY,
  question_id UUID REFERENCES questions(id),
  answer_text TEXT NOT NULL,
  is_correct BOOLEAN NOT NULL,
  order_index INTEGER NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMP NOT NULL DEFAULT NOW()
)
```

## API Contracts

### Health Check Endpoint
```
GET /api/v1/health
Response:
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP"
    }
  },
  "version": "1.0.0",
  "javaVersion": "21"
}
```

## File Structure

### Backend File Structure
```
com.uznai/
├── config/                          # Configuration classes
│   ├── DatabaseConfig.java
│   ├── SecurityConfig.java
│   ├── ThreadConfig.java            # Virtual threads configuration
│   └── LoggingConfig.java
├── controller/                      # REST controllers
│   └── HealthController.java
├── entity/                          # JPA entities
│   ├── User.java
│   ├── Role.java
│   ├── Quiz.java
│   ├── Question.java
│   └── Answer.java
├── repository/                      # Spring Data repositories
│   ├── UserRepository.java
│   ├── RoleRepository.java
│   ├── QuizRepository.java
│   ├── QuestionRepository.java
│   └── AnswerRepository.java
├── exception/                       # Custom exceptions
│   ├── GlobalExceptionHandler.java
│   └── ApiError.java
├── UznaiApplication.java            # Main application class
└── resources/
    ├── application.yml              # Application properties
    └── db/migration/                # Flyway migration scripts
        ├── V1__init_schema.sql
        └── V2__init_roles.sql
```

### Frontend File Structure
```
src/
├── app/                             # Next.js app router pages
│   ├── page.tsx                     # Landing page
│   └── layout.tsx                   # Root layout
├── components/                      # UI components
│   ├── ui/                          # shadcn/ui components
│   └── layout/                      # Layout components
├── lib/                             # Utility functions
│   ├── api-client.ts                # Axios setup
│   └── utils.ts                     # Helper functions
├── types/                           # TypeScript types and interfaces
│   └── index.ts                     # Common type definitions
└── styles/                          # Global styles
    └── globals.css                  # Tailwind imports and global styles
```

## Implementation Considerations

### Technical Challenges
- Setting up proper database migration strategies with Flyway
- Configuring security properly from the beginning to avoid refactoring later
- Establishing a scalable project structure that supports future RFCs
- Configuring cost-effective hosting while ensuring good performance
- Properly configuring virtual threads for optimal performance

### Performance Considerations
- Configure connection pooling appropriately for the database
- Set up proper caching headers for static assets
- Implement response compression
- Configure appropriate JVM settings for Spring Boot application
- Leverage Java 21 virtual threads for I/O operations
- Configure thread pools appropriately to take advantage of virtual threads

### Security Considerations
- Configure secure headers for the application
- Set up CORS policies
- Initialize security configurations (to be expanded in RFC-002)
- Ensure secure database credentials handling

### Java 21 Feature Usage
- Configure Spring Boot to use virtual threads for servlet processing
- Set up Executor service with virtual threads for background tasks
- Use appropriate configuration to leverage Java 21's improved performance
- Ensure hosting platforms support Java 21 runtime

### Testing Strategy
- Unit tests for repository interfaces
- Integration tests for database migrations
- Health check endpoint tests
- CI pipeline verification tests
- Virtual thread behavior tests for concurrent operations

## Acceptance Criteria

1. Project Setup:
   - Spring Boot application initializes without errors with Java 21
   - Next.js application initializes without errors
   - All dependencies are correctly configured
   - Project builds successfully

2. Database Configuration:
   - Database connection is successful
   - Flyway migrations run successfully
   - Initial schema is created
   - Basic data seeding works (roles)

3. CI/CD Pipeline:
   - GitHub Actions workflow runs successfully
   - Linting, testing, and building steps work
   - Deployment to hosting platform is successful
   - Health check endpoint is accessible after deployment

4. Cost-Effective Hosting:
   - Application is deployed on Railway.app, Render, or Fly.io
   - Application fits within free tier or low-cost tier
   - Database is provisioned on a free or low-cost plan
   - Environment variables are securely configured
   - Java 21 runtime is properly configured

5. Java 21 Configuration:
   - Virtual threads are properly configured
   - Health check endpoint reports Java 21 version
   - Application leverages Java 21 features appropriately
   - Hosting platform correctly supports Java 21

## Previous RFCs
None (this is the first RFC).

## Future RFCs
- RFC-002: User Authentication & Profile (builds directly on this infrastructure)
- All subsequent RFCs will build upon the foundation established in this RFC

## Complexity
Medium

## Timeline Estimate
1-2 weeks
